# Запуска storybot для начинающих ~~программистов~~

1. Скачайте данный репозиторий из github (для Windows желательно установить GitBash)

<b>Для тех, кто понимает что это</b>
```shell
git clone https://github.com/ciricc/storybot-for-beginners.git && cd storybot-for-beginners
```

Или вот еще способ: <br/>
<img src="https://i.imgur.com/Yva8JEN.png"/>


2. Установите Node.JS 10 версии <a href="https://nodejs.org">nodejs.org</a>
3. Откройте командную строку в папке `storybot-for-beginners` (этот шаг можно пропустить, если вы вводили команды из прошлых шагов полностью)

<b>Если вы не совсем понимаете, как это сделать, запустите файл `install.bat` (для MAC OS - install.command)</b>

<img src="https://i.imgur.com/Cfd92p5.png" alt="Неоходимо прописать cmd сверху там где путь к папке и нажать Enter"/>

4. Введите команду
```shell
npm i
```

5. Настройте бота по собственным нуждам следуя инструкциям из документации <a href="https://www.npmjs.com/package/storybot">storybot</a>
Об этом ниже


## Настройка ботов

Так как настройка бота - дело непростое для тех, кто не владеет навыками программирования, я постарался сделать максимально доступную форму конфигурации. Чтобы понять что к чему, пройдем дальше.

### Папка bots

Папка `bots` - это список `YAML` (.yml) файлов с конфигурацией ботов. Каждый новый файл - новый конфиг для нового бота. Если в конфигурации бота не указывается его название, то название берется из имени файла без расширения (пр. `example.yml` - name: `example`). Для удобства редактирования конфигурации я рекомендую использовать программу <a href="https://notepad-plus-plus.org/downloads/" target="_blank">Notepad++</a>. При редактировании конфигурации не используйте TAB'ы (символ \t) и соблюдайте уровни вложенности (1-2 пробела)! Большая часть ошибок в настройке - именно в неправильном использовании языка YAML (он проще, чем кажется)

Простейший пример конфига бота:

`bots/new_bot.yml`:
```YAML
bot: #Уровень настройки бота
 name: "New_Bot" #Название бота
 groupIds: [1, 2, 3] #Идентификаторы групп
collector: #Уровень настройки коллектора
 tokens: ["token_1", "token_2"] #Токены коллектора (юзеров) через запятую и в ДВОЙНЫХ КАВЫЧКАХ ( " )
 target: #Уровень настройки таргета
  sex: 1
viewers: #Уровень настройки виюверов
 liza: #Название виювера и ниже его настройки
  account: 
   username: "liza-iza@gmailinbox.com"
   password: "AzaRaLize45067!"
```

Проще некуда! Но это не все! Новое обновление приносит новые фичи (и баги)!

### Папка accounts

Данная папка служит для хранения `.json` файлов с данными аккаунтов, которые будут использоваться в ботах. Не рекомендуется изменять ее содержимое вручную (удалять/переименовывать файлы), так как она генерируется автоматически на основе конфигов. То есть все изменения нужно проводить только в конфигах.

<b>Как настраивать конфиг, чтобы не вводить токены, взятые с неба.</b>

#### Уровень accounts
Для настройки аккаунтов используется уровень accounts в конфиге бота, в нем вы указываете имена аккаунтов и их данные, а также можете указать, нужно ли обновить токен для данного аккаунта. Пример ниже

`bots/a.yml`:
```YAML
accounts:
 liza:
  username: "liza-iza@gmailinbox.com"
  password: "AzaRaLize45067!"
  reauth: false # Если нужно обновить токен - true, иначе - false
 kirill:
  username: "kiryha2008god@yandex.ru"
  password: "_FiramirTHEBEST00956"
bot:
 name: "Bot_1"
collector:
 tokens: ["liza"] #Здесь вместо реального токена используется имя аккаунта и в дальнейшем бот 
 # автоматически подставит полученный токен аккаунта
viewers:
 viewer_first:
  account: "kirill" #Здесь вместо настроек аккаунта используется просто имя аккаунта
```

Если вы используете много ботов, то необязательно снова и снова настраивать в каждом боте аккаунты.
Достаточно указать их в самом верхнем боте (самый первый файл конфига в алфавитном порядке). А в остальных конфигах просто не указывать.

`bots/b.yml`:
```YAML
bot:
 name: "Bot_2"
collector: 
 tokens: ["kirill"]
viewers:
 viewer_first:
  account: "liza"
```

На этом все, осталось только запустить

## Запуск

6. Запустите бота через команду
```shell
npm run start
```

<b>Если вы не знаете как открыть консоль, то запуск делайте через файл `start.bat` (для MAC OS - start.command)</b>


<i>Чтобы остановить бота, можно закрыть окно консоли или нажать сочетание `Ctrl + C`</i>

## Запуск в фоне
Для запуска в фоне рекомендую использовать утилиту `pm2`

Установить:
```shell
npm i -g pm2
```

Запустить в фоне:
```shell
pm2 start index.js
```

Посмотреть лог:
```shell
pm2 logs 0
```

Также можно посмотреть лог в файле лога (`~/.pm2/logs/index-(out|error).txt`),
для пользователей Windows: `C:\Users\User\.pm2\logs\index-(out|error).txt`

Перезапустить:
```shell
pm2 restart 0
```

Остановить:
```shell
pm2 stop 0
```

Вместо `0` может быть ID процесса pm2, посмотреть весь список можно следующей командой
```shell
pm2 list
``` 
